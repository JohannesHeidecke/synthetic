{% extends "base.html" %}
{% block title %}DRMap{% endblock %}
{% block js %}<script src="/static/drmap.js" type="text/javascript" ></script>{% endblock %}
{% block content %}

<div style="float:left">
<form name="generator_form" action="/lab/" method="post" enctype="multipart/form-data">{% csrf_token %}

<input type="submit" value="Run Simulation" />

<h3>Link Probability Matrix</h3>
<table>
    <thead>
    	<tr>
        	<th scope="col">&nbsp;</th>
        {% for col in type_list %}
            <th scope="col">{{ col }}</th>
        {% endfor %}
        </tr>
    </thead>
    <tbody>
{% for col in type_list %}
    <tr>
     	<td>{{ col }}</td>
    {% for row in type_list %}
        <td><input name="link_cell_{{ row }}_{{ col }}" type="text" size="4" value="0" /></td>
    {% endfor %}
    </tr>
{% endfor %}
</tbody>
</table>

<br />
<h3>Random Probability Matrix</h3>
<table>
    <thead>
    	<tr>
        	<th scope="col">&nbsp;</th>
        {% for col in type_list %}
            <th scope="col">{{ col }}</th>
        {% endfor %}
        </tr>
    </thead>
    <tbody>
{% for col in type_list %}
    <tr>
     	<td>{{ col }}</td>
    {% for row in type_list %}
        <td><input name="random_cell_{{ row }}_{{ col }}" type="text" size="4" value="0" /></td>
    {% endfor %}
    </tr>
{% endfor %}
</tbody>
</table>

<br />
<h3>Follow Probability Matrix</h3>
<table>
    <thead>
    	<tr>
        	<th scope="col">&nbsp;</th>
        {% for col in type_list %}
            <th scope="col">{{ col }}</th>
        {% endfor %}
        </tr>
    </thead>
    <tbody>
{% for col in type_list %}
    <tr>
     	<td>{{ col }}</td>
    {% for row in type_list %}
        <td><input name="follow_cell_{{ row }}_{{ col }}" type="text" size="4" value="0" /></td>
    {% endfor %}
    </tr>
{% endfor %}
</tbody>
</table>

<br />
<h3>Reverse Follow Probability Matrix</h3>
<table>
    <thead>
    	<tr>
        	<th scope="col">&nbsp;</th>
        {% for col in type_list %}
            <th scope="col">{{ col }}</th>
        {% endfor %}
        </tr>
    </thead>
    <tbody>
{% for col in type_list %}
    <tr>
     	<td>{{ col }}</td>
    {% for row in type_list %}
        <td><input name="rfollow_cell_{{ row }}_{{ col }}" type="text" size="4" value="0" /></td>
    {% endfor %}
    </tr>
{% endfor %}
</tbody>
</table>

<br />
<h3>Weight Matrix</h3>
<table>
    <thead>
    	<tr>
        	<th scope="col">&nbsp;</th>
        {% for col in type_list %}
            <th scope="col">{{ col }}</th>
        {% endfor %}
        </tr>
    </thead>
    <tbody>
    <tr>
     	<td>&nbsp;</td>
    {% for row in type_list %}
        <td><input name="weight_cell_{{ row }}" type="text" size="4" value="0" /></td>
    {% endfor %}
    </tr>
</tbody>
</table>

<br />
<h3>Stop Matrix</h3>
<table>
    <thead>
    	<tr>
        	<th scope="col">&nbsp;</th>
        {% for col in type_list %}
            <th scope="col">{{ col }}</th>
        {% endfor %}
        </tr>
    </thead>
    <tbody>
    <tr>
     	<td>&nbsp;</td>
    {% for row in type_list %}
        <td><input name="stop_cell_{{ row }}" type="text" size="4" value="0" /></td>
    {% endfor %}
    </tr>
</tbody>
</table>

<br />
<input type="submit" value="Run Simulation" />

</form>
</div>


<div style="float:right; width:300px;">
<canvas id="drmap_canvas" width="300" height="300">
Sorry, your browser does not support canvas.
</canvas>
</div>


<script language="javascript">

var bins = {{ bins }};

{% if previous_values %}
var type_count = {{ type_count }};

var m_links = [{{ m_links }}];
var m_random = [{{ m_random }}];
var m_follow = [{{ m_follow }}];
var m_rfollow = [{{ m_rfollow }}];
var m_weight = [{{ m_weight }}];
var m_stop = [{{ m_stop }}];

var formObject = document.forms['generator_form'];

var x;
var y;
var pos = 0;

for (y = 0; y < type_count; y++) {
    for (x = 0; x < type_count; x++) {
        formObject.elements['link_cell_' + x + '_' + y].value = m_links[pos];
        formObject.elements['random_cell_' + x + '_' + y].value = m_random[pos];
        formObject.elements['follow_cell_' + x + '_' + y].value = m_follow[pos];
        formObject.elements['rfollow_cell_' + x + '_' + y].value = m_rfollow[pos];
        pos++;
    }
}

for (pos = 0; pos < type_count; pos++) {
    formObject.elements['weight_cell_' + pos].value = m_weight[pos];
    formObject.elements['stop_cell_' + pos].value = m_stop[pos];
}
{% endif %}

var vals = [{{ map_data }}];

drawDRMap(vals, bins, 'drmap_canvas');

</script>

{% endblock %}
