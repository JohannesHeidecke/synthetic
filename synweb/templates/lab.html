{% extends "base.html" %}
{% block title %}DRMap{% endblock %}
{% block js %}<script src="/static/drmap.js" type="text/javascript" ></script>{% endblock %}
{% block content %}

<form name="generator_form" action="/lab/" method="post" enctype="multipart/form-data">{% csrf_token %}

<div>
<input type="submit" value="Run Simulation" />
<label for="id_nodes">Nodes:</label> <input type="text" name="nodes" id="id_nodes" size="5" value="1000" />
<label for="id_edges">Edges:</label> <input type="text" name="edges" id="id_edges" size="5" value="10000" />
<label for="id_cycles">Cycles:</label> <input type="text" name="cycles" id="id_cycles" size="5" value="10000" />
<label for="id_walk">Max Walk:</label> <input type="text" name="max_walk" id="id_max_walk" size="3" value="20" />
</div>

<div style="float:left">
<h3>Weight Matrix</h3>
<table>
    <thead>
    	<tr>
        	<th scope="col">&nbsp;</th>
        {% for col in type_list %}
            <th scope="col">{{ col }}</th>
        {% endfor %}
        </tr>
    </thead>
    <tbody>
    <tr>
     	<td>&nbsp;</td>
    {% for row in type_list %}
        <td><input name="weight_cell_{{ row }}" type="text" size="4" value="0" /></td>
    {% endfor %}
    </tr>
</tbody>
</table>

<br />
<h3>Link Probability Matrix</h3>
<table>
    <thead>
    	<tr>
        	<th scope="col">&nbsp;</th>
        {% for col in type_list %}
            <th scope="col">{{ col }}</th>
        {% endfor %}
        </tr>
    </thead>
    <tbody>
{% for col in type_list %}
    <tr>
     	<td>{{ col }}</td>
    {% for row in type_list %}
        <td><input name="link_cell_{{ row }}_{{ col }}" type="text" size="4" value="0" /></td>
    {% endfor %}
    </tr>
{% endfor %}
</tbody>
</table>

<br />
<h3>Follow Probability Matrix</h3>
<table>
    <thead>
    	<tr>
        	<th scope="col">&nbsp;</th>
        {% for col in type_list %}
            <th scope="col">{{ col }}</th>
        {% endfor %}
        </tr>
    </thead>
    <tbody>
{% for col in type_list %}
    <tr>
     	<td>{{ col }}</td>
    {% for row in type_list %}
        <td><input name="follow_cell_{{ row }}_{{ col }}" type="text" size="4" value="0" /></td>
    {% endfor %}
    </tr>
{% endfor %}
</tbody>
</table>
</div>

<div style="float:left; margin-left:50px">
<h3>Stop Matrix</h3>
<table>
    <thead>
    	<tr>
        	<th scope="col">&nbsp;</th>
        {% for col in type_list %}
            <th scope="col">{{ col }}</th>
        {% endfor %}
        </tr>
    </thead>
    <tbody>
    <tr>
     	<td>&nbsp;</td>
    {% for row in type_list %}
        <td><input name="stop_cell_{{ row }}" type="text" size="4" value="0" /></td>
    {% endfor %}
    </tr>
</tbody>
</table>

<br />
<h3>Random Probability Matrix</h3>
<table>
    <thead>
    	<tr>
        	<th scope="col">&nbsp;</th>
        {% for col in type_list %}
            <th scope="col">{{ col }}</th>
        {% endfor %}
        </tr>
    </thead>
    <tbody>
{% for col in type_list %}
    <tr>
     	<td>{{ col }}</td>
    {% for row in type_list %}
        <td><input name="random_cell_{{ row }}_{{ col }}" type="text" size="4" value="0" /></td>
    {% endfor %}
    </tr>
{% endfor %}
</tbody>
</table>

<br />
<h3>Reverse Follow Probability Matrix</h3>
<table>
    <thead>
    	<tr>
        	<th scope="col">&nbsp;</th>
        {% for col in type_list %}
            <th scope="col">{{ col }}</th>
        {% endfor %}
        </tr>
    </thead>
    <tbody>
{% for col in type_list %}
    <tr>
     	<td>{{ col }}</td>
    {% for row in type_list %}
        <td><input name="rfollow_cell_{{ row }}_{{ col }}" type="text" size="4" value="0" /></td>
    {% endfor %}
    </tr>
{% endfor %}
</tbody>
</table>

</div>

</form>

<h3>DRMap</h3>
<div style="float:left; width:300px;">
<canvas id="drmap_canvas" width="300" height="300">
Sorry, your browser does not support canvas.
</canvas>
</div>

<script language="javascript">

var bins = {{ bins }};

{% if previous_values %}
var type_count = {{ type_count }};

var nodes = {{ nodes }};
var edges = {{ edges }};
var cycles = {{ cycles }};
var max_walk = {{ max_walk }};
var m_links = [{{ m_links }}];
var m_random = [{{ m_random }}];
var m_follow = [{{ m_follow }}];
var m_rfollow = [{{ m_rfollow }}];
var m_weight = [{{ m_weight }}];
var m_stop = [{{ m_stop }}];

var formObject = document.forms['generator_form'];

formObject.elements['nodes'].value = nodes;
formObject.elements['edges'].value = edges;
formObject.elements['cycles'].value = cycles;
formObject.elements['max_walk'].value = max_walk;

var x;
var y;
var pos = 0;

for (y = 0; y < type_count; y++) {
    for (x = 0; x < type_count; x++) {
        formObject.elements['link_cell_' + x + '_' + y].value = m_links[pos];
        formObject.elements['random_cell_' + x + '_' + y].value = m_random[pos];
        formObject.elements['follow_cell_' + x + '_' + y].value = m_follow[pos];
        formObject.elements['rfollow_cell_' + x + '_' + y].value = m_rfollow[pos];
        pos++;
    }
}

for (pos = 0; pos < type_count; pos++) {
    formObject.elements['weight_cell_' + pos].value = m_weight[pos];
    formObject.elements['stop_cell_' + pos].value = m_stop[pos];
}

{% endif %}

var vals = [{{ map_data }}];

drawDRMap(vals, bins, 'drmap_canvas');

</script>

{% endblock %}
